<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>JSDoc: Source: js/Board.js</title>
    
    <script src="scripts/prettify/prettify.js"> </script>
    <script src="scripts/prettify/lang-css.js"> </script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <link type="text/css" rel="stylesheet" href="styles/prettify-tomorrow.css">
    <link type="text/css" rel="stylesheet" href="styles/jsdoc-default.css">
</head>

<body>

<div id="main">
    
    <h1 class="page-title">Source: js/Board.js</h1>
    
    


    
    <section>
        <article>
            <pre class="prettyprint source linenums"><code>/**
 * @constructor
 * @class GameBoard
 */
var GameBoard = function () {
	/**
	 * Self reference where 'this' is not available
	 * @protected
	 */
   var board = this;
   
   /**
	 * The current list of objects
	 * @public
	 * @type {Array.&lt;object>}
	 */
   this.objects = [];
	/**
	 * The current list of object types
	 * @public
	 * @type {Array.&lt;object>}
	 */
   this.objTypeCounts = [];

	/**
	 * The current list of objects
	 * @public
	 * @type {Array.&lt;Tiles>|Array.&lt;Sprites>}
	 */
   this.map = [];
   
	
   this.loadMap = function () {
      this.map = pn.localStorage.getArrayFromLocalStorage("World");
   }
   
   // Add a new object to the object list
   this.add = function (obj) {
      obj.board=this;
      this.objects.push(obj);
      this.objTypeCounts[obj.type] = (this.objTypeCounts[obj.type] || 0) + 1;
      return obj;
   };
   
   this.objectsToRemove = [];
   
   // Mark an object for removal
   this.markToRemove = function (obj) {
      var wasStillAlive = (this.objects.indexOf(obj) != -1);
      if(wasStillAlive) { 
         this.objectsToRemove.push(obj);  
      }
      return wasStillAlive;
   };

   // Reset the list of objectsToRemove objects
   this.resetObjectsToRemove = function () { 
      this.objectsToRemove = []; 
   }

   // Remove objects marked for removal from the list
   this.finalizeRemoved = function () {
      for(var i = 0, len = this.objectsToRemove.length; i &lt; len; i++) {
         var idx = this.objects.indexOf(this.objectsToRemove[i]);
         if(idx != -1) {
            this.objTypeCounts[this.objectsToRemove[i].type]--;
            this.objects.splice(idx,1);
         }
      }
   };
   
   // Call the same method on all current objects
   this.iterate = function (funcName) {
      var args = Array.prototype.slice.call(arguments,1);
      for(var i = 0, len = this.objects.length; i &lt; len; i++) {
         var obj = this.objects[i];
         obj[funcName].apply(obj,args)
      }
   };
   
   this.overlap = function (o1,o2) {
      return !((o1.y+o1.h-1&lt;o2.y) || (o1.y>o2.y+o2.h-1) ||
               (o1.x+o1.w-1&lt;o2.x) || (o1.x>o2.x+o2.w-1));
   };
   
      
   this.collide = function (obj,opposingtype) { 
      for(var i = 0, len = this.objects.length; i &lt; len; i++) { 
         var opponent = this.objects[i];
         if(obj != opponent) { 
            var collision = (!opposingtype || opponent.type === opposingtype) &amp;&amp; board.overlap(obj,opponent) ;
            if (collision) {
               return opponent;
            }
         } 
      }
      return false;
   };


   // Call update on all objects and then delete
   // any objects that have been marked for removal
   this.update = function (dt) {
      this.resetObjectsToRemove();
      this.iterate('update',dt);
      this.finalizeRemoved();      
   };
   
   // Draw all the objects
   this.draw= function (ctx) {
      this.iterate('draw',ctx);
   };
};
</code></pre>
        </article>
    </section>




</div>

<nav>
    <h2><a href="index.html">Index</a></h2><h3>Classes</h3><ul><li><a href="Game.html">Game</a></li><li><a href="GameBoard.html">GameBoard</a></li><li><a href="GameServer.html">GameServer</a></li><li><a href="HttpService.html">HttpService</a></li><li><a href="LocalStorage.html">LocalStorage</a></li><li><a href="Menu.html">Menu</a></li><li><a href="Socket.html">Socket</a></li><li><a href="Socket_.html">Socket(2)</a></li></ul><h3>Events</h3><ul><li><a href="global.html#event:socket:add_character">socket:add_character</a></li><li><a href="global.html#event:socket:add_player">socket:add_player</a></li><li><a href="global.html#event:socket:add_room">socket:add_room</a></li><li><a href="global.html#event:socket:add_user">socket:add_user</a></li><li><a href="global.html#event:socket:added_character">socket:added_character</a></li><li><a href="global.html#event:socket:added_player">socket:added_player</a></li><li><a href="global.html#event:socket:added_user">socket:added_user</a></li><li><a href="global.html#event:socket:connection">socket:connection</a></li><li><a href="global.html#event:socket:get_room_list">socket:get_room_list</a></li><li><a href="global.html#event:socket:get_user_list">socket:get_user_list</a></li><li><a href="global.html#event:socket:join_room">socket:join_room</a></li><li><a href="global.html#event:socket:kill_character">socket:kill_character</a></li><li><a href="global.html#event:socket:killed_character">socket:killed_character</a></li><li><a href="global.html#event:socket:leave_room">socket:leave_room</a></li><li><a href="global.html#event:socket:load_map">socket:load_map</a></li><li><a href="global.html#event:socket:loaded_map">socket:loaded_map</a></li><li><a href="global.html#event:socket:move_character">socket:move_character</a></li><li><a href="global.html#event:socket:moved_character">socket:moved_character</a></li><li><a href="global.html#event:socket:remove_room">socket:remove_room</a></li><li><a href="global.html#event:socket:remove_user">socket:remove_user</a></li><li><a href="global.html#event:socket:removed_player">socket:removed_player</a></li><li><a href="global.html#event:socket:resp_user">socket:resp_user</a></li><li><a href="global.html#event:socket:resp_user_list">socket:resp_user_list</a></li><li><a href="global.html#event:socket:update_players">socket:update_players</a></li><li><a href="global.html#event:socket:update_rooms">socket:update_rooms</a></li><li><a href="global.html#event:socket:used_player">socket:used_player</a></li><li><a href="global.html#event:window:load">window:load</a></li></ul><h3>Global</h3><ul><li><a href="global.html#extensions">extensions</a></li><li><a href="global.html#OBJECT_ENEMY_PROJECTILE">OBJECT_ENEMY_PROJECTILE</a></li><li><a href="global.html#OBJECT_PLAYER">OBJECT_PLAYER</a></li><li><a href="global.html#OBJECT_POWERUP">OBJECT_POWERUP</a></li><li><a href="global.html#OBJECT_TILE_COLLIDE">OBJECT_TILE_COLLIDE</a></li><li><a href="global.html#OBJECT_TILE_NO_COLLIDE">OBJECT_TILE_NO_COLLIDE</a></li><li><a href="global.html#PLAYER_SIZE">PLAYER_SIZE</a></li><li><a href="global.html#playGame">playGame</a></li><li><a href="global.html#pn">pn</a></li><li><a href="global.html#sprites">sprites</a></li><li><a href="global.html#startGame">startGame</a></li></ul>
</nav>

<br clear="both">

<footer>
    Documentation generated by <a href="https://github.com/jsdoc3/jsdoc">JSDoc 3.3.0-dev</a> on Thu Jan 02 2014 15:23:14 GMT-0800 (Pacific Standard Time)
</footer>

<script> prettyPrint(); </script>
<script src="scripts/linenumber.js"> </script>
</body>
</html>
